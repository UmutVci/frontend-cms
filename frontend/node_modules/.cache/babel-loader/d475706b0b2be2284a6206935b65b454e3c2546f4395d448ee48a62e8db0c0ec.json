{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useParams,useNavigate}from'react-router-dom';import SessionService from'../../../services/SessionService';import HallService from'../../../services/HallService';import useAuth from\"../../auth/useAuth\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function SeatsPage(){const{sessionId}=useParams();const navigate=useNavigate();const[session,setSession]=useState(null);const[hall,setHall]=useState(null);const[seats,setSeats]=useState([]);const[selectedSeats,setSelectedSeats]=useState([]);const[loading,setLoading]=useState(true);useEffect(()=>{async function loadData(){try{const sessionData=await SessionService.getById(sessionId);const hallData=await HallService.getById(sessionData.hall);const seatsData=await SessionService.getSeatsBySessionId(sessionId);console.log(\"‚úÖ Session:\",sessionData);console.log(\"‚úÖ Hall:\",hallData);console.log(\"‚úÖ Seats:\",seatsData);setSession(sessionData);setHall(hallData);setSeats(seatsData);}catch(err){}finally{setLoading(false);}}loadData();},[sessionId]);const handleSeatClick=seatId=>{setSelectedSeats(prev=>prev.includes(seatId)?prev.filter(id=>id!==seatId):[...prev,seatId]);};const handleReserve=async()=>{try{var _useAuth$getState$use;const customerId=(_useAuth$getState$use=useAuth.getState().user)===null||_useAuth$getState$use===void 0?void 0:_useAuth$getState$use.id;console.log(\"üü¢ Reserving seats:\",selectedSeats,\"CustomerID:\",customerId);await SessionService.reserveSeats(sessionId,selectedSeats,customerId);navigate(\"/clerk/reservation-success?sessionId=\".concat(session.id,\"&hallId=\").concat(hall.id,\"&seatIds=\").concat(selectedSeats.join(',')));}catch(err){console.error(\"‚ùå Reservation Error: \",err);alert(\"Rezervasyon ba≈üarƒ±sƒ±z.\");}};if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"p-6 text-center\",children:\"Loading...\"});if(!session||!hall)return/*#__PURE__*/_jsx(\"div\",{className:\"p-6 text-red-600\",children:\"Error.\"});const seatMap={};seats.forEach(seat=>{seatMap[\"\".concat(seat.seatRow.toUpperCase(),\"-\").concat(seat.seatColumn)]=seat;});const totalSeats=seats.length;const seatsPerRow=8;const rowCount=Math.ceil(totalSeats/seatsPerRow);return/*#__PURE__*/_jsx(\"main\",{className:\"inner-container relative flex-1 p-10 bg-[#D9D9D9]\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white w-[75%] h-full mx-auto my-4 rounded-xl p-6 overflow-auto\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-2xl font-bold\",children:[\"Hall: \",hall.name]}),/*#__PURE__*/_jsxs(\"h3\",{className:\"mb-4\",children:[\"Session: \",new Date(session.startTime).toLocaleString()]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-black p-6 rounded-xl inline-block\",children:Array.from({length:rowCount}).map((_,rowIdx)=>{const rowLabel=String.fromCharCode(65+rowIdx);return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-white mr-2 w-6 font-bold\",children:rowLabel}),/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-2\",children:Array.from({length:seatsPerRow}).map((_,colIdx)=>{const seatKey=\"\".concat(rowLabel,\"-\").concat(colIdx+1);const seat=seatMap[seatKey];const booked=seat===null||seat===void 0?void 0:seat.booked;const selected=seat&&selectedSeats.includes(seat.id);return/*#__PURE__*/_jsx(\"button\",{onClick:()=>seat&&handleSeatClick(seat.id),disabled:!seat||booked,className:\"\\n                                                w-10 h-10 rounded text-sm font-bold\\n                                                \".concat(!seat?'bg-transparent':booked?'bg-gray-400 cursor-not-allowed':selected?'bg-red-600 text-white':'bg-green-500 text-white',\"\\n                                            \"),children:colIdx+1},seatKey);})})]},rowLabel);})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{onClick:handleReserve,disabled:selectedSeats.length===0,className:\"mt-6 bg-[#400505] text-white px-6 py-2 rounded\",children:selectedSeats.length>0?\"Do Reservation  (\".concat(selectedSeats.length,\")\"):\"Pick a Seat\"})]})});}","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","SessionService","HallService","useAuth","jsx","_jsx","jsxs","_jsxs","SeatsPage","sessionId","navigate","session","setSession","hall","setHall","seats","setSeats","selectedSeats","setSelectedSeats","loading","setLoading","loadData","sessionData","getById","hallData","seatsData","getSeatsBySessionId","console","log","err","handleSeatClick","seatId","prev","includes","filter","id","handleReserve","_useAuth$getState$use","customerId","getState","user","reserveSeats","concat","join","error","alert","className","children","seatMap","forEach","seat","seatRow","toUpperCase","seatColumn","totalSeats","length","seatsPerRow","rowCount","Math","ceil","name","Date","startTime","toLocaleString","Array","from","map","_","rowIdx","rowLabel","String","fromCharCode","colIdx","seatKey","booked","selected","onClick","disabled"],"sources":["/Users/umutavc/WebstormProjects/cms/src/features/clerk/ClerkSeat/SeatsPage.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport SessionService from '../../../services/SessionService';\nimport HallService from '../../../services/HallService';\nimport useAuth from \"../../auth/useAuth\";\n\nexport default function SeatsPage() {\n    const { sessionId } = useParams();\n    const navigate = useNavigate();\n    const [session, setSession] = useState(null);\n    const [hall, setHall] = useState(null);\n    const [seats, setSeats] = useState([]);\n    const [selectedSeats, setSelectedSeats] = useState([]);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        async function loadData() {\n            try {\n                const sessionData = await SessionService.getById(sessionId);\n                const hallData = await HallService.getById(sessionData.hall);\n                const seatsData = await SessionService.getSeatsBySessionId(sessionId);\n\n                console.log(\"‚úÖ Session:\", sessionData);\n                console.log(\"‚úÖ Hall:\", hallData);\n                console.log(\"‚úÖ Seats:\", seatsData);\n\n                setSession(sessionData);\n                setHall(hallData);\n                setSeats(seatsData);\n            } catch (err) {\n            } finally {\n                setLoading(false);\n            }\n        }\n        loadData();\n    }, [sessionId]);\n\n    const handleSeatClick = (seatId) => {\n        setSelectedSeats(prev =>\n            prev.includes(seatId) ? prev.filter(id => id !== seatId) : [...prev, seatId]\n        );\n    };\n\n    const handleReserve = async () => {\n        try {\n            const customerId = useAuth.getState().user?.id;\n            console.log(\"üü¢ Reserving seats:\", selectedSeats, \"CustomerID:\", customerId);\n\n            await SessionService.reserveSeats(sessionId, selectedSeats, customerId);\n\n            navigate(`/clerk/reservation-success?sessionId=${session.id}&hallId=${hall.id}&seatIds=${selectedSeats.join(',')}`);\n\n        } catch (err) {\n            console.error(\"‚ùå Reservation Error: \", err);\n            alert(\"Rezervasyon ba≈üarƒ±sƒ±z.\");\n        }\n    };\n\n\n    if (loading) return <div className=\"p-6 text-center\">Loading...</div>;\n    if (!session || !hall) return <div className=\"p-6 text-red-600\">Error.</div>;\n\n    const seatMap = {};\n    seats.forEach(seat => {\n        seatMap[`${seat.seatRow.toUpperCase()}-${seat.seatColumn}`] = seat;\n    });\n\n    const totalSeats = seats.length;\n    const seatsPerRow = 8;\n    const rowCount = Math.ceil(totalSeats / seatsPerRow);\n\n    return (\n        <main className=\"inner-container relative flex-1 p-10 bg-[#D9D9D9]\">\n            <div className=\"bg-white w-[75%] h-full mx-auto my-4 rounded-xl p-6 overflow-auto\">\n            <h2 className=\"text-2xl font-bold\">Hall: {hall.name}</h2>\n            <h3 className=\"mb-4\">Session: {new Date(session.startTime).toLocaleString()}</h3>\n            <div className=\"bg-black p-6 rounded-xl inline-block\">\n                {Array.from({ length: rowCount }).map((_, rowIdx) => {\n                    const rowLabel = String.fromCharCode(65 + rowIdx);\n                    return (\n                        <div key={rowLabel} className=\"flex items-center mb-2\">\n                            <div className=\"text-white mr-2 w-6 font-bold\">{rowLabel}</div>\n                            <div className=\"flex gap-2\">\n                                {Array.from({ length: seatsPerRow }).map((_, colIdx) => {\n                                    const seatKey = `${rowLabel}-${colIdx + 1}`;\n                                    const seat = seatMap[seatKey];\n                                    const booked = seat?.booked;\n                                    const selected = seat && selectedSeats.includes(seat.id);\n\n                                    return (\n                                        <button\n                                            key={seatKey}\n                                            onClick={() => seat && handleSeatClick(seat.id)}\n                                            disabled={!seat || booked}\n                                            className={`\n                                                w-10 h-10 rounded text-sm font-bold\n                                                ${!seat\n                                                ? 'bg-transparent'\n                                                : booked\n                                                    ? 'bg-gray-400 cursor-not-allowed'\n                                                    : selected\n                                                        ? 'bg-red-600 text-white'\n                                                        : 'bg-green-500 text-white'}\n                                            `}\n                                        >\n                                            {colIdx + 1}\n                                        </button>\n                                    );\n                                })}\n                            </div>\n                        </div>\n                    );\n                })}\n            </div>\n                <br />\n            <button\n                onClick={handleReserve}\n                disabled={selectedSeats.length === 0}\n                className=\"mt-6 bg-[#400505] text-white px-6 py-2 rounded\"\n            >\n                {selectedSeats.length > 0\n                    ? `Do Reservation  (${selectedSeats.length})`\n                    : \"Pick a Seat\"}\n            </button>\n        </div>\n        </main>\n    );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}